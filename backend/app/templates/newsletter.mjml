<mjml>
  <mj-head>
    <mj-title>{{ branding.company_name }} Newsletter</mj-title>
    <mj-preview>Community Newsletter for {{ newsletter.newsletter_metadata.location }}</mj-preview>
    <mj-attributes>
      <mj-all font-family="Georgia, Helvetica, Arial, sans-serif" />
      <mj-text font-size="14px" color="#ffffff" line-height="22px" />
    </mj-attributes>
  </mj-head>
  
  <mj-body background-color="#000000">
    
    <!-- Header -->
    <mj-section background-color="#000000" padding="40px 20px">
      <mj-column>
        <mj-text align="center" color="#ffffff" font-size="36px" font-weight="bold">
          {{ branding.company_name }}
        </mj-text>
        <mj-text align="center" color="#cccccc" font-size="18px">
          Community Newsletter - {{ newsletter.newsletter_metadata.location }}
        </mj-text>
        <mj-text align="center" color="#cccccc" font-size="16px">
          {{ current_date.strftime('%B %d, %Y') }}
        </mj-text>
      </mj-column>
    </mj-section>

    <!-- Welcome Message -->
    {% if newsletter.content.main_channel.welcome_message %}
    <mj-section background-color="#000000" padding="30px 20px">
      <mj-column>
        <mj-text color="#cccccc" font-size="16px" line-height="24px">
          {{ newsletter.content.main_channel.welcome_message }}
        </mj-text>
      </mj-column>
    </mj-section>
    {% endif %}

    <!-- Community Updates -->
    {% if newsletter.content.main_channel.community_updates %}
    <mj-section background-color="#000000" padding="30px 20px">
      <mj-column>
        <mj-text color="#ffffff" font-size="24px" font-weight="bold" padding-bottom="15px">
          Community Updates
        </mj-text>
        {% for update in newsletter.content.main_channel.community_updates %}
        <mj-text color="#cccccc" font-size="14px" padding-bottom="10px">
          • {{ update }}
        </mj-text>
        {% endfor %}
      </mj-column>
    </mj-section>
    {% endif %}

    <!-- Featured Message -->
    {% if newsletter.content.main_channel.featured_message %}
    <mj-section background-color="#000000" padding="30px 20px">
      <mj-column>
        <mj-text color="#ffffff" font-size="24px" font-weight="bold" padding-bottom="15px">
          Featured This Week
        </mj-text>
        <mj-text color="#cccccc" font-size="16px" line-height="24px">
          {{ newsletter.content.main_channel.featured_message }}
        </mj-text>
      </mj-column>
    </mj-section>
    {% endif %}

    <!-- Events Section -->
    {% if newsletter.content.events %}
    <mj-section background-color="#000000" padding="40px 20px">
      <mj-column>
        <mj-text align="center" color="#ffffff" font-size="32px" font-weight="bold">
          Upcoming Events
        </mj-text>
      </mj-column>
    </mj-section>

    {% for event in newsletter.content.events %}
    {% set is_even = loop.index0 % 2 == 0 %}
    
    <!-- Event {{ loop.index }} - {% if is_even %}Image Left{% else %}Image Right{% endif %} -->
    <mj-section background-color="#000000" padding="40px 20px" {% if not is_even %}direction="rtl"{% endif %}>
      <mj-column width="80%">
        {% if event.images and event.images|length > 0 %}
        <mj-image 
          src="{{ event.images[0] }}" 
          alt="{{ event.event_title }}" 
          width="100%" 
          height="320px"
          padding="{% if is_even %}0 20px 0 0{% else %}0 0 0 20px{% endif %}"
          border-radius="12px">
        </mj-image>
        {% endif %}
      </mj-column>
      <mj-column width="20%">
        <mj-text color="#ffffff" font-size="20px" font-weight="bold" padding-bottom="15px" {% if not is_even %}direction="ltr"{% endif %}>
          {{ event.event_title }}
        </mj-text>
        <mj-text color="#cccccc" font-size="12px" line-height="18px" padding-bottom="15px" {% if not is_even %}direction="ltr"{% endif %}>
          {{ event.description }}
        </mj-text>
        
        <!-- Event Details Box -->
        <mj-text background-color="#1a1a1a" color="#ffffff" font-size="11px" padding="15px" border-radius="8px" border-left="4px solid {{ branding.primary_color or '#1E40AF' }}" {% if not is_even %}direction="ltr"{% endif %}>
          <strong style="color:#ffffff;">📅 Date:</strong> <span style="color:#cccccc;">{{ event.date }}</span><br/><br/>
          <strong style="color:#ffffff;">📍 Location:</strong> <span style="color:#cccccc;">{{ event.location }}</span><br/><br/>
          <strong style="color:#ffffff;">💰 Cost:</strong> <span style="color:#cccccc;">{{ event.cost }}</span><br/>
          {% if event.booking_details %}<br/>
          <strong style="color:#ffffff;">📋 Booking:</strong> <span style="color:#cccccc;">{{ event.booking_details }}</span>
          {% endif %}
        </mj-text>
        
        <!-- Registration Button -->
        {% if event.source_url %}
        <mj-button 
          background-color="{{ branding.primary_color or '#1E40AF' }}" 
          color="#ffffff" 
          font-size="14px" 
          font-weight="bold" 
          border-radius="20px" 
          padding="15px 25px"
          href="{{ event.source_url }}"
          target="_blank"
          align="{% if is_even %}left{% else %}right{% endif %}"
          inner-padding="10px 20px">
          🎫 Register / More Info
        </mj-button>
        {% endif %}
      </mj-column>
    </mj-section>
    
    <!-- Event Separator -->
    <mj-section background-color="#000000" padding="30px 40px">
      <mj-column>
        <mj-divider border-color="#333333" border-width="3px"></mj-divider>
      </mj-column>
    </mj-section>
    {% endfor %}

    <!-- Call to Action -->
    <mj-section background-color="#000000" padding="50px 20px">
      <mj-column>
        <mj-button 
          background-color="{{ branding.primary_color or '#1E40AF' }}" 
          color="#ffffff" 
          font-size="20px" 
          font-weight="bold" 
          border-radius="30px" 
          padding="25px 50px"
          inner-padding="18px 40px">
          Discover All Community Events
        </mj-button>
      </mj-column>
    </mj-section>
    {% endif %}

    <!-- Footer -->
    <mj-section background-color="#000000" padding="40px 20px">
      <mj-column>
        <mj-text align="center" color="#ffffff" font-size="24px" font-weight="bold" padding-bottom="10px">
          {{ branding.company_name }}
        </mj-text>
        <mj-text align="center" color="#cccccc" font-size="14px" padding-bottom="10px">
          {{ branding.footer_description }}
        </mj-text>
        <mj-text align="center" color="#888888" font-size="12px">
          © {{ current_date.year }} {{ branding.company_name }}. All rights reserved.
        </mj-text>
      </mj-column>
    </mj-section>
  </mj-body>
</mjml>
